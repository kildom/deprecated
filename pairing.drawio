<mxfile host="app.diagrams.net" modified="2022-08-22T11:23:56.739Z" agent="5.0 (X11)" etag="MdiLgLw5TT0Hux_4ovxo" version="20.0.1" type="github">
  <diagram id="vdH0c-xZ-W6iA9BROo6P" name="Page-1">
    <mxGraphModel dx="1422" dy="877" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-1" value="Central" style="shape=cube;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;darkOpacity=0.05;darkOpacity2=0.1;" parent="1" vertex="1">
          <mxGeometry x="490" y="40" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-3" value="" style="endArrow=none;html=1;rounded=0;entryX=0;entryY=0;entryDx=70;entryDy=80;entryPerimeter=0;" parent="1" target="FENTOsaE2WCGUyI8QtAQ-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="880" as="sourcePoint" />
            <mxPoint x="490" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-5" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="160" as="sourcePoint" />
            <mxPoint x="560" y="160" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-6" value="Pairing" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-5" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-13" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="280" as="sourcePoint" />
            <mxPoint x="290" y="280" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-14" value="Central hello: CH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-13" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="25" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-15" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="200" as="sourcePoint" />
            <mxPoint x="560" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-16" value="Pairing" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-15" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-19" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="240" as="sourcePoint" />
            <mxPoint x="560" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-20" value="Pairing" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-19" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-21" value="Shared key:&lt;br&gt;&amp;nbsp; SK = KDF(X25519(CSK, RPK), RR)&lt;br&gt;&lt;br&gt;Central random:&lt;br&gt;&amp;nbsp; CR = random() [7 bytes]&lt;br&gt;&lt;br&gt;Remote index:&lt;br&gt;&amp;nbsp; ID = next_free_index() [1 byte]&lt;br&gt;&lt;br&gt;Central hello packet:&lt;br&gt;&amp;nbsp; CH = { CPK, AES(SK, {ID CR RR}) }" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="560" y="160" width="250" height="400" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-22" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="320.0000000000001" as="sourcePoint" />
            <mxPoint x="560" y="320.0000000000001" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-23" value="Pairing" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-22" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-24" value="" style="shape=image;html=1;verticalAlign=top;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;imageAspect=0;aspect=fixed;image=https://cdn4.iconfinder.com/data/icons/basic-user-interface-elements/700/exit-delete-remove-close-x-128.png" parent="1" vertex="1">
          <mxGeometry x="280" y="270" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-27" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" target="FENTOsaE2WCGUyI8QtAQ-30" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="360.0000000000001" as="sourcePoint" />
            <mxPoint x="230" y="360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-28" value="Central hello: CH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-27" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="25" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-31" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="480" as="sourcePoint" />
            <mxPoint x="490" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-32" value="Remote hello: RH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-31" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-35" value="" style="shape=image;html=1;verticalAlign=top;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;imageAspect=0;aspect=fixed;image=https://cdn4.iconfinder.com/data/icons/basic-user-interface-elements/700/exit-delete-remove-close-x-128.png" parent="1" vertex="1">
          <mxGeometry x="480" y="470" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-36" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="520" as="sourcePoint" />
            <mxPoint x="560" y="520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-37" value="Action" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-36" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-40" value="Wait for first action from ID with serial SN" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="560" y="560" width="250" height="120" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-41" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="560" as="sourcePoint" />
            <mxPoint x="560" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-42" value="Remote hello: RH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-41" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-45" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="599.58" as="sourcePoint" />
            <mxPoint x="560" y="599.58" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-46" value="Action" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-45" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-47" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="639.58" as="sourcePoint" />
            <mxPoint x="560" y="639.58" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-48" value="Remote hello: RH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-47" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-49" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="679.9999999999999" as="sourcePoint" />
            <mxPoint x="560" y="679.9999999999999" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-50" value="Action" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-49" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-51" value="Accept pairing:&lt;br&gt;&amp;nbsp; memory[ID] = { SK, T, SN }" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="560" y="680" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-52" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="729.9999999999999" as="sourcePoint" />
            <mxPoint x="560" y="729.9999999999999" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-53" value="Remote hello: RH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-52" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-54" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="770.42" as="sourcePoint" />
            <mxPoint x="560" y="770.42" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-55" value="Action" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-54" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-2" value="Remote" style="shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
          <mxGeometry x="200" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-4" value="" style="endArrow=none;html=1;rounded=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" target="FENTOsaE2WCGUyI8QtAQ-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="880" as="sourcePoint" />
            <mxPoint x="520" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-30" value="Remote random:&lt;br&gt;&amp;nbsp; RR = random() [8 bytes]&lt;br&gt;&lt;br&gt;Pairing packet:&lt;br&gt;&amp;nbsp; PP = { RPK, RR }" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10" y="160" width="250" height="200" as="geometry" />
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-56" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="810" as="sourcePoint" />
            <mxPoint x="560" y="810" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-57" value="Remote hello: RH" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-56" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-58" value="" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="850.4200000000001" as="sourcePoint" />
            <mxPoint x="560" y="850.4200000000001" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-59" value="Action" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="FENTOsaE2WCGUyI8QtAQ-58" vertex="1" connectable="0">
          <mxGeometry x="0.1212" y="-3" relative="1" as="geometry">
            <mxPoint x="-15" y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="FENTOsaE2WCGUyI8QtAQ-29" value="Shared key:&lt;br&gt;&amp;nbsp; SK = KDF(X25519(CPK, RSK), RR)&lt;br&gt;&lt;br&gt;Remote hello packet:&lt;br&gt;&amp;nbsp; RH =&amp;nbsp;AES(SK, {ID CR SN})&lt;br&gt;&lt;br&gt;Accept pairing:&lt;br&gt;&amp;nbsp; memory = { ID, SK }&lt;br&gt;&lt;br&gt;Radio transmit for a few seconds:&lt;br&gt;&amp;nbsp; Action = { ID, AES(SK, {SN T Q}) }" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="10" y="360" width="250" height="500" as="geometry" />
        </mxCell>
        <mxCell id="Zcq1oVJiTlp6bigTHLSe-1" value="&lt;div&gt;&lt;b&gt;This is wrong, because SK will be always new:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;SN must be regenerated on each clock (T) reset to ensure non-repeating packets.&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;&lt;br&gt;&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;Other option: use something else, e.g.:&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;AR (action random) =&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;AES({ID CR SN}, {ID CR RR})[0:7]&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;&lt;br&gt;&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;&lt;b&gt;and then:&lt;/b&gt;&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;Accept pairing:&lt;br&gt;&amp;nbsp; memory = { ID, SK, AR }&lt;br&gt;&lt;br&gt;Radio transmit for a few seconds:&lt;br&gt;&amp;nbsp; Action = { ID, AES(SK, {AR T Q}) }&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;&lt;br&gt;&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;&lt;b&gt;on central:&lt;/b&gt;&lt;br&gt;&lt;/strike&gt;&lt;/div&gt;&lt;div&gt;&lt;strike&gt;Accept pairing:&lt;br&gt;&amp;nbsp; memory[ID] = { SK, T, SN, AR }&lt;/strike&gt;&lt;/div&gt;" style="shape=callout;whiteSpace=wrap;html=1;perimeter=calloutPerimeter;rotation=0;size=20;position=0.6;base=29;align=left;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="30" y="540" width="200" height="330" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
